<Window x:Class="ZeroTrustMigrationAddin.Views.AISettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:ZeroTrustMigrationAddin.Converters"
        Title="Azure OpenAI Settings (Optional Enhancement)" 
        Height="600" Width="700"
        WindowStartupLocation="CenterScreen"
        Background="#F5F5F5">

    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="ðŸ¤– Azure OpenAI Settings" 
                       FontSize="24" FontWeight="Bold" 
                       Foreground="#0078D4"/>
            <TextBlock Text="Enable GPT-4 enhanced recommendations (optional - requires Azure OpenAI subscription)" 
                       FontSize="14" Foreground="#666"
                       TextWrapping="Wrap"
                       Margin="0,5,0,0"/>
        </StackPanel>

        <!-- Settings Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- Feature Overview -->
                <Border Background="#E3F2FD" CornerRadius="8" Padding="15" Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="ðŸ’¡ What does this enable?" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#333">
                            <Run Text="âœ“ GPT-4 powered enrollment and workload recommendations"/>
                            <LineBreak/>
                            <Run Text="âœ“ AI-powered stall analysis with root cause detection"/>
                            <LineBreak/>
                            <Run Text="âœ“ Context-aware guidance based on YOUR specific migration state"/>
                            <LineBreak/>
                            <Run Text="âœ“ Incorporates velocity trends, phased plans, and FastTrack best practices"/>
                            <LineBreak/><LineBreak/>
                            <Run Text="Without Azure OpenAI: AI Recommendations section shows setup instructions" FontWeight="SemiBold"/>
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Enable/Disable Toggle -->
                <Border Background="White" CornerRadius="8" Padding="15" Margin="0,0,0,15">
                    <StackPanel>
                        <CheckBox x:Name="IsEnabledCheckBox" 
                                  Content="Enable Azure OpenAI Integration" 
                                  FontSize="14" FontWeight="SemiBold"
                                  IsChecked="{Binding IsOpenAIEnabled, Mode=TwoWay}"/>
                        <TextBlock Text="Turn this on to use GPT-4 enhanced recommendations" 
                                   FontSize="11" Foreground="#666" Margin="22,5,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Configuration Settings -->
                <Border Background="White" CornerRadius="8" Padding="15" 
                        IsEnabled="{Binding IsOpenAIEnabled}">
                    <StackPanel>
                        <TextBlock Text="Azure OpenAI Configuration" 
                                   FontSize="16" FontWeight="SemiBold" Margin="0,0,0,15"/>

                        <!-- Endpoint -->
                        <TextBlock Text="Endpoint URL *" FontSize="12" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <TextBox x:Name="EndpointTextBox"
                                 Text="{Binding OpenAIEndpoint, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 FontSize="12"
                                 Padding="8"
                                 Height="32"
                                 Margin="0,0,0,5"/>
                        <TextBlock Text="Example: https://contoso.openai.azure.com" 
                                   FontSize="10" Foreground="#666" Margin="0,0,0,15"/>

                        <!-- Deployment Name -->
                        <TextBlock Text="Deployment Name *" FontSize="12" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <TextBox x:Name="DeploymentNameTextBox"
                                 Text="{Binding OpenAIDeploymentName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 FontSize="12"
                                 Padding="8"
                                 Height="32"
                                 Margin="0,0,0,5"/>
                        <TextBlock Text="Example: gpt-4o-deployment (your deployment name in Azure)" 
                                   FontSize="10" Foreground="#666" Margin="0,0,0,15"/>

                        <!-- API Key -->
                        <TextBlock Text="API Key *" FontSize="12" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <PasswordBox x:Name="ApiKeyPasswordBox"
                                     FontSize="12"
                                     Padding="8"
                                     Height="32"
                                     Margin="0,0,0,5"
                                     PasswordChanged="ApiKeyPasswordBox_PasswordChanged"/>
                        <TextBlock Text="From Azure Portal â†’ Azure OpenAI â†’ Keys and Endpoint" 
                                   FontSize="10" Foreground="#666" Margin="0,0,0,10"/>

                        <!-- Security Note -->
                        <Border Background="#FFF3CD" CornerRadius="4" Padding="10" Margin="0,0,0,15">
                            <TextBlock TextWrapping="Wrap" FontSize="11" Foreground="#856404">
                                <Run Text="âš ï¸ Security: API key is stored locally in %APPDATA%\CloudJourneyAddin\openai-config.json"/>
                                <LineBreak/>
                                <Run Text="For production: Consider using Azure Managed Identity instead"/>
                            </TextBlock>
                        </Border>

                        <!-- Test Connection Button -->
                        <Button x:Name="TestConnectionButton"
                                Content="ðŸ” Test Connection"
                                Command="{Binding TestOpenAIConnectionCommand}"
                                FontSize="12"
                                Padding="15,8"
                                Background="#0078D4"
                                Foreground="White"
                                BorderThickness="0"
                                Cursor="Hand"
                                HorizontalAlignment="Left"
                                Margin="0,0,0,10">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" 
                                            CornerRadius="4" 
                                            Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>

                        <!-- Status Message -->
                        <Border x:Name="StatusBorder"
                                Background="#D4EDDA"
                                BorderBrush="#28A745"
                                BorderThickness="1"
                                CornerRadius="4"
                                Padding="10"
                                Visibility="{Binding HasOpenAIStatus, Converter={StaticResource BoolToVisibilityConverter}}">
                            <TextBlock x:Name="StatusTextBlock"
                                       Text="{Binding OpenAIStatus}"
                                       TextWrapping="Wrap"
                                       FontSize="11"/>
                        </Border>
                    </StackPanel>
                </Border>

                <!-- Cost Estimate -->
                <Border Background="#FFF3CD" CornerRadius="8" Padding="15" Margin="0,15,0,0">
                    <StackPanel>
                        <TextBlock Text="ðŸ’° Cost Estimate" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock TextWrapping="Wrap" FontSize="11" Foreground="#856404">
                            <Run Text="â€¢ Per dashboard session: ~$0.69 (5 GPT-4 calls)"/>
                            <LineBreak/>
                            <Run Text="â€¢ 1000 users Ã— 5 sessions/month = $3,450/month (no cache)"/>
                            <LineBreak/>
                            <Run Text="â€¢ With 30-min caching: ~$1,200/month (65% reduction)"/>
                            <LineBreak/><LineBreak/>
                            <Run Text="ROI: Prevents 1-2 migration stalls = $40K+ labor savings per customer"/>
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Setup Guide Link -->
                <Border Background="#E3F2FD" CornerRadius="8" Padding="15" Margin="0,15,0,0">
                    <StackPanel>
                        <TextBlock Text="ðŸ“š Need Help Setting Up?" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock TextWrapping="Wrap" FontSize="11" Foreground="#0078D4" Margin="0,0,0,5">
                            <Run Text="1. Create Azure OpenAI resource in Azure Portal"/>
                            <LineBreak/>
                            <Run Text="2. Deploy GPT-4 model (recommend: gpt-4o-2024-08-06)"/>
                            <LineBreak/>
                            <Run Text="3. Copy Endpoint URL, Deployment Name, and API Key"/>
                            <LineBreak/>
                            <Run Text="4. Enter details above and click Test Connection"/>
                        </TextBlock>
                        <Button Content="ðŸ“– Open Azure OpenAI Setup Guide"
                                Command="{Binding OpenSetupGuideCommand}"
                                FontSize="11"
                                Padding="10,6"
                                Background="White"
                                Foreground="#0078D4"
                                BorderBrush="#0078D4"
                                BorderThickness="1"
                                Cursor="Hand"
                                HorizontalAlignment="Left"
                                Margin="0,5,0,0">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" 
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="4" 
                                            Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
            <Button Content="ðŸ’¾ Save Settings" 
                    Command="{Binding SaveOpenAIConfigCommand}"
                    Width="140" Height="36" 
                    FontSize="13"
                    Background="#107C10" 
                    Foreground="White"
                    BorderThickness="0"
                    Cursor="Hand"
                    Margin="0,0,10,0">
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="4" 
                                Padding="15,8">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Button.Template>
            </Button>
            <Button Content="Cancel" 
                    Click="CancelButton_Click"
                    Width="100" Height="36" 
                    FontSize="13"
                    Background="#6C757D" 
                    Foreground="White"
                    BorderThickness="0"
                    Cursor="Hand">
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="4" 
                                Padding="15,8">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Button.Template>
            </Button>
        </StackPanel>
    </Grid>
</Window>
