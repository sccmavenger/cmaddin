<UserControl x:Class="ZeroTrustMigrationAddin.Views.EnrollmentConfidenceCard"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:ZeroTrustMigrationAddin.Converters">

    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        
        <Style x:Key="ScoreBar" TargetType="Border">
            <Setter Property="Height" Value="8"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Background" Value="#E0E0E0"/>
        </Style>
    </UserControl.Resources>

    <Border Background="White" CornerRadius="8" Padding="20" 
            BorderBrush="#E0E0E0" BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header with Score Circle -->
            <Grid Grid.Row="0" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Score Circle -->
                <Border Grid.Column="0" Width="80" Height="80" CornerRadius="40" 
                        BorderThickness="6" Margin="0,0,20,0">
                    <Border.BorderBrush>
                        <SolidColorBrush Color="{Binding BandColor}"/>
                    </Border.BorderBrush>
                    <Border.Background>
                        <SolidColorBrush Color="{Binding BandColor}" Opacity="0.1"/>
                    </Border.Background>
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <TextBlock Text="{Binding Score}" FontSize="28" FontWeight="Bold" 
                                   HorizontalAlignment="Center">
                            <TextBlock.Foreground>
                                <SolidColorBrush Color="{Binding BandColor}"/>
                            </TextBlock.Foreground>
                        </TextBlock>
                        <TextBlock Text="/100" FontSize="10" Foreground="#666666" 
                                   HorizontalAlignment="Center" Margin="0,-3,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Title and Description -->
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="ðŸŽ¯ ENROLLMENT CONFIDENCE" FontSize="14" FontWeight="Bold" Foreground="#333333"/>
                    <TextBlock Text="{Binding Band}" FontSize="18" FontWeight="SemiBold" Margin="0,5,0,0">
                        <TextBlock.Foreground>
                            <SolidColorBrush Color="{Binding BandColor}"/>
                        </TextBlock.Foreground>
                    </TextBlock>
                    <TextBlock Text="{Binding Explanation}" FontSize="12" Foreground="#666666" 
                               TextWrapping="Wrap" Margin="0,5,0,0" MaxWidth="350"/>
                </StackPanel>

                <!-- Expand/Collapse Button -->
                <Button Grid.Column="2" Content="{Binding ShowBreakdown, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter='CollapseExpand'}"
                        Command="{Binding ToggleBreakdownCommand}"
                        Background="Transparent" BorderThickness="0"
                        FontSize="12" Foreground="#0078D4" Cursor="Hand"
                        VerticalAlignment="Top">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <TextBlock Text="â–¼ Show Breakdown" Foreground="#0078D4" FontSize="12"/>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </Grid>

            <!-- Score Breakdown (Expandable) -->
            <Border Grid.Row="1" Background="#F8F9FA" CornerRadius="6" Padding="15" Margin="0,0,0,15"
                    Visibility="{Binding ShowBreakdown, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel>
                    <TextBlock Text="SCORE BREAKDOWN" FontSize="11" FontWeight="SemiBold" 
                               Foreground="#666666" Margin="0,0,0,15"/>

                    <!-- Velocity Component (30%) -->
                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="140"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="50"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="Velocity (30%)" FontSize="12" Foreground="#333333"/>
                        <Border Grid.Column="1" Style="{StaticResource ScoreBar}">
                            <Border CornerRadius="4" HorizontalAlignment="Left" Background="#0078D4">
                                <Border.Width>
                                    <Binding Path="VelocityScore" Converter="{StaticResource BoolToVisibilityConverter}" ConverterParameter="ScoreWidth"/>
                                </Border.Width>
                            </Border>
                        </Border>
                        <TextBlock Grid.Column="2" Text="{Binding VelocityScore}" FontSize="12" 
                                   FontWeight="SemiBold" Foreground="#0078D4" HorizontalAlignment="Right"/>
                    </Grid>

                    <!-- Success Rate Component (25%) -->
                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="140"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="50"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="Success Rate (25%)" FontSize="12" Foreground="#333333"/>
                        <Border Grid.Column="1" Style="{StaticResource ScoreBar}">
                            <Border CornerRadius="4" HorizontalAlignment="Left" Background="#107C10">
                                <Border.Width>
                                    <Binding Path="SuccessRateScore" Converter="{StaticResource BoolToVisibilityConverter}" ConverterParameter="ScoreWidth"/>
                                </Border.Width>
                            </Border>
                        </Border>
                        <TextBlock Grid.Column="2" Text="{Binding SuccessRateScore}" FontSize="12" 
                                   FontWeight="SemiBold" Foreground="#107C10" HorizontalAlignment="Right"/>
                    </Grid>

                    <!-- Complexity Component (20%) -->
                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="140"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="50"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="Complexity (20%)" FontSize="12" Foreground="#333333"/>
                        <Border Grid.Column="1" Style="{StaticResource ScoreBar}">
                            <Border CornerRadius="4" HorizontalAlignment="Left" Background="#F57C00">
                                <Border.Width>
                                    <Binding Path="ComplexityScore" Converter="{StaticResource BoolToVisibilityConverter}" ConverterParameter="ScoreWidth"/>
                                </Border.Width>
                            </Border>
                        </Border>
                        <TextBlock Grid.Column="2" Text="{Binding ComplexityScore}" FontSize="12" 
                                   FontWeight="SemiBold" Foreground="#F57C00" HorizontalAlignment="Right"/>
                    </Grid>

                    <!-- Infrastructure Component (15%) -->
                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="140"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="50"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="Infrastructure (15%)" FontSize="12" Foreground="#333333"/>
                        <Border Grid.Column="1" Style="{StaticResource ScoreBar}">
                            <Border CornerRadius="4" HorizontalAlignment="Left" Background="#6A1B9A">
                                <Border.Width>
                                    <Binding Path="InfrastructureScore" Converter="{StaticResource BoolToVisibilityConverter}" ConverterParameter="ScoreWidth"/>
                                </Border.Width>
                            </Border>
                        </Border>
                        <TextBlock Grid.Column="2" Text="{Binding InfrastructureScore}" FontSize="12" 
                                   FontWeight="SemiBold" Foreground="#6A1B9A" HorizontalAlignment="Right"/>
                    </Grid>

                    <!-- Conditional Access Component (10%) -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="140"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="50"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="CA Readiness (10%)" FontSize="12" Foreground="#333333"/>
                        <Border Grid.Column="1" Style="{StaticResource ScoreBar}">
                            <Border CornerRadius="4" HorizontalAlignment="Left" Background="#00897B">
                                <Border.Width>
                                    <Binding Path="ConditionalAccessScore" Converter="{StaticResource BoolToVisibilityConverter}" ConverterParameter="ScoreWidth"/>
                                </Border.Width>
                            </Border>
                        </Border>
                        <TextBlock Grid.Column="2" Text="{Binding ConditionalAccessScore}" FontSize="12" 
                                   FontWeight="SemiBold" Foreground="#00897B" HorizontalAlignment="Right"/>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- Drivers and Detractors -->
            <Grid Grid.Row="2" Visibility="{Binding ShowBreakdown, Converter={StaticResource BoolToVisibilityConverter}}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="15"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Top Drivers -->
                <Border Grid.Column="0" Background="#E8F5E9" CornerRadius="6" Padding="15">
                    <StackPanel>
                        <TextBlock Text="âœ… TOP DRIVERS" FontSize="11" FontWeight="SemiBold" 
                                   Foreground="#2E7D32" Margin="0,0,0,10"/>
                        <ItemsControl ItemsSource="{Binding TopDrivers}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="0,0,0,8">
                                        <TextBlock Text="{Binding Name}" FontSize="12" FontWeight="SemiBold" 
                                                   Foreground="#333333"/>
                                        <TextBlock Text="{Binding Description}" FontSize="11" Foreground="#666666" 
                                                   TextWrapping="Wrap"/>
                                        <TextBlock Text="{Binding ImpactDisplay}" FontSize="10" FontWeight="Bold"
                                                   Foreground="#107C10" Margin="0,3,0,0"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- Top Detractors -->
                <Border Grid.Column="2" Background="#FFEBEE" CornerRadius="6" Padding="15">
                    <StackPanel>
                        <TextBlock Text="âš ï¸ TOP DETRACTORS" FontSize="11" FontWeight="SemiBold" 
                                   Foreground="#C62828" Margin="0,0,0,10"/>
                        <ItemsControl ItemsSource="{Binding TopDetractors}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="0,0,0,8">
                                        <TextBlock Text="{Binding Name}" FontSize="12" FontWeight="SemiBold" 
                                                   Foreground="#333333"/>
                                        <TextBlock Text="{Binding Description}" FontSize="11" Foreground="#666666" 
                                                   TextWrapping="Wrap"/>
                                        <TextBlock Text="{Binding ImpactDisplay}" FontSize="10" FontWeight="Bold"
                                                   Foreground="#D32F2F" Margin="0,3,0,0"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Quick Actions -->
            <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,15,0,0">
                <Button Content="ðŸ“Š View Full Analysis" Command="{Binding ViewDetailsCommand}"
                        Background="Transparent" BorderBrush="#0078D4" BorderThickness="1"
                        Foreground="#0078D4" Padding="12,6" FontSize="12" Cursor="Hand" Margin="0,0,10,0">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}" 
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="4" Padding="{TemplateBinding Padding}">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
                <Button Content="ðŸ’¡ Get Recommendations" Command="{Binding GetRecommendationsCommand}"
                        Background="#0078D4" Foreground="White" 
                        Padding="12,6" FontSize="12" BorderThickness="0" Cursor="Hand">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}" CornerRadius="4" Padding="{TemplateBinding Padding}">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
